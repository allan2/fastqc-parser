<!DOCTYPE html>
<html lang="en">

<head>
	<title>FastQC Aggregated Report</title>
	<style>
		body {
			margin: 0;
			font-family: sans-serif;
		}

		header {
			padding: 0.5em;
			background: #eee;
		}

		h2 {
			color: #800000;
			font-size: 1.5em;
		}

		#toolbar {
			padding: 0 16px;
		}

		#per-base-quality-grid {
			width: 100%;
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			/* column gap of 6px allows 4 imagse with 400px width on 1920 width screen */
			column-gap: 6px;

		}

		.per-base-quality {
			display: block;
			max-width: 400px;
			height: auto;
		}

		/* Show pass by default */
		.pass {
			display: block;
		}

		#results-count {
			margin-left: 72px;
		}
	</style>
</head>

<body>
	<header>
		Generated on {{ dt.to_rfc2822() }}
	</header>
	<main>
		<div id="toolbar">
			<h2>Per base sequence quality</h2>
			<input type="checkbox" id="check" onClick="toggleShowFailOnly()">
			<label for="check">Show failed only</label>
			<span id="results-count"></span>
		</div>

		<div id="per-base-quality-grid">
			{% for (k, f) in sample_dirs %}
			{% let flag -%}
			{% match f %}
			{% when Flag::Pass %}
			{% let flag = "pass" -%}
			{% when Flag::Warn %}
			{% let flag = "fail" -%}
			{% when Flag::Fail %}
			{% let flag = "fail" -%}
			{% endmatch %}
			{% let key = k.replace("Sample0", "Sample") %}
			<figure class="{{ flag }}">
				<img class="per-base-quality" src="{{key}}_fastqc/Images/per_base_quality.png" />
				<figcaption>{{key}}</figcaption>
			</figure>
			{% endfor %}
		</div>
	</main>
	<script>
		"use strict";
		var showFailOnly = false;
		var totalCount = document.querySelectorAll('figure').length;
		var passCount = document.querySelectorAll('.pass').length;
		var numResults = totalCount;
		var resultsCountEl = document.getElementById("results-count");
		var showingMsg = function (count) {
			var s = "Showing ".concat(count, " result");
			if (count != 1) {
				s += "s";
			}
			return s;
		};
		if (resultsCountEl !== null) {
			resultsCountEl.innerHTML = showingMsg(numResults);
		}
		var toggleShowFailOnly = function () {
			showFailOnly = !showFailOnly;
			var x = document.getElementsByClassName("pass");
			for (var i = 0; i < x.length; i++) {
				if (x[i].style.display == "none") {
					x[i].style.display = "block";
				}
				else {
					x[i].style.display = "none";
				}
			}
			if (resultsCountEl !== null) {
				var numResults_1;
				if (!showFailOnly) {
					numResults_1 = totalCount;
				}
				else {
					numResults_1 = passCount;
				}
				resultsCountEl.innerHTML = showingMsg(numResults_1);
			}
		};
	</script>
</body>

</html>
